# Client application of our cool grid ðŸš€

âœ¨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** âœ¨

## Install nvm to more convenient development in the future

[Reference to guide how to install and use nvm](https://www.freecodecamp.org/news/node-version-manager-nvm-install-guide/)

In this project we're using node 18, that is mean you should switch to node 18:

```bash
nvm install 18 && nvm use 18
```

After closing terminal, nvm will set version to default which you installed first.

To set default version node you could use this command (use your version that you want instead "your_version"):

```bash
nvm alias default your_version
```

Now when you will close terminal default version of node will be "your_version"

## To install yarn

```bash
npm install -g yarn
```

## Our project contains custom registry packages

You will notice file .yarnrc.yml This file contain custom registry.
To install all packages without errors you should ask frontend team for the credentials. And [set Environment Variables](https://chlee.co/how-to-setup-environment-variables-for-windows-mac-and-linux/) NPM_USER and NEXUS_PASS from our custom registry.

## Install dependencies

```bash
yarn install
```

## To run application in dev mode (serving with hot reload)

To run main quantgrid application use this command:

```bash
yarn nx serve quantgrid
```

To run other application you could use name of other application

## Before creating a Merge Request run format and lint commands to clean up the code:

```bash
yarn format
yarn lint
```

## Environment variables

To set environment variables you should set them using the file `apps/quantgrid/external-env.js`

## Authentication

To run an application with authentication, you should set `authAuthority` and `authClientId` variables in file `apps/quantgrid/external-env.js`:

## Temporary solution to disable cors for localhost.

Add this snippet to the 'backend/src/main/java/com.epam.deltix.quantgrid/web/config/AuthConfig.java'

```bash
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

    @Bean
    CorsConfigurationSource
    corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList("*"));
        configuration.setAllowedMethods(Arrays.asList("*"));
        configuration.setAllowedHeaders(Arrays.asList("*"));
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        return source;
    }
```

## Graph of the related libraries and applications

Run `nx graph` to see a diagram of the dependencies of the projects.

## Run e2e tests locally

if the local application uses authentication, set the environment variables:  
AUTH_TYPE to the authentication type which is used on the local env. Supported values are `auth0` and `keycloak`.  
QUANTGRID_TEST_USERNAME to a valid user name for the application  
QUANTGRID_TEST_PASSWORD to password for the user set in the previous variable

run `npx nx e2e quantgrid`  
you can change the target browsers by editing the section `projects` in `frontend\apps\quantgrid\playwright` directory

## Configure allure

Go to https://github.com/allure-framework/allure2/releases/ and download the latest version selecting suitable archive type  
Unpack the archive  
Add allure bin directory to the PATH env variable

## Generate allure report

run `allure generate ./allure-results -o ./allure-report --clean`

## Open allure report

in the case of report generated locally, run `allure open allure-report`  
in the case of gitlab report, extract the report to some directory and run `allure open "path_to_extracted_directory"`
